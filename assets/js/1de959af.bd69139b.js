"use strict";(self.webpackChunkgrc=self.webpackChunkgrc||[]).push([[7666],{4447:(e,a,s)=>{s.r(a),s.d(a,{assets:()=>o,contentTitle:()=>t,default:()=>h,frontMatter:()=>l,metadata:()=>c,toc:()=>r});var n=s(5893),i=s(1151);const l={},t="Building With Spack",c={id:"hpc-tutorials/installing-hpc-software/building-with-spack",title:"Building With Spack",description:"Spack is a system for installing packages for HPC centers. Spack",source:"@site/docs/02-hpc-tutorials/02-installing-hpc-software/01-building-with-spack.md",sourceDirName:"02-hpc-tutorials/02-installing-hpc-software",slug:"/hpc-tutorials/installing-hpc-software/building-with-spack",permalink:"/docs/hpc-tutorials/installing-hpc-software/building-with-spack",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:1,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Installing HPC Software",permalink:"/docs/category/installing-hpc-software"},next:{title:"Building From Scratch",permalink:"/docs/hpc-tutorials/installing-hpc-software/building-from-scratch"}},o={},r=[{value:"Installing <code>spack</code>",id:"installing-spack",level:2},{value:"Uninstalling <code>spack</code>",id:"uninstalling-spack",level:2},{value:"List packages provided by <code>spack</code>",id:"list-packages-provided-by-spack",level:2},{value:"Install packages",id:"install-packages",level:2},{value:"List installed packages",id:"list-installed-packages",level:2},{value:"All installed packages",id:"all-installed-packages",level:3},{value:"Particular package",id:"particular-package",level:3},{value:"Particular package with verbosity",id:"particular-package-with-verbosity",level:3},{value:"Load packages",id:"load-packages",level:2},{value:"Unload packages",id:"unload-packages",level:2},{value:"Uninstall packages",id:"uninstall-packages",level:2},{value:"What happens if <code>spack</code> fails?",id:"what-happens-if-spack-fails",level:2}];function d(e){const a={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",...(0,i.a)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(a.h1,{id:"building-with-spack",children:"Building With Spack"}),"\n",(0,n.jsxs)(a.p,{children:[(0,n.jsx)(a.a,{href:"https://github.com/spack/spack.git",children:"Spack"})," is a system for installing packages for HPC centers. Spack\ncan be easily installed on supercomputers since it does not require root privileges. Spack works by\nbuilding code from source."]}),"\n",(0,n.jsxs)(a.p,{children:["This section provides an overview of installing software with spack and some of the complexities of spack.\nThis is not a full documentation of spack, it just contains the things we see come up often. Read through\ntheir ",(0,n.jsx)(a.a,{href:"https://spack.readthedocs.io/en/latest/",children:"documentation"})," to understand better how to use spack."]}),"\n",(0,n.jsx)(a.p,{children:"Spack is by no means perfect. It has plenty of bugs and nuances."}),"\n",(0,n.jsxs)(a.h2,{id:"installing-spack",children:["Installing ",(0,n.jsx)(a.code,{children:"spack"})]}),"\n",(0,n.jsxs)(a.p,{children:["The official install guide for ",(0,n.jsx)(a.code,{children:"spack"})," is ",(0,n.jsx)(a.a,{href:"https://spack-tutorial.readthedocs.io/en/latest/tutorial_basics.html",children:"here"}),".\nSince the install is fairly simple, we'll just repeat here:"]}),"\n",(0,n.jsx)(a.pre,{children:(0,n.jsx)(a.code,{className:"language-bash",children:'# Clone spack into your current directory\n# This will clone spack v0.20\ngit clone --depth=100 --branch=releases/v0.20 https://github.com/spack/spack.git\n# Setup the spack environment for this shell\n# This will modify environment variables\ncd spack\n. share/spack/setup-env.sh\n# Ensure that spack is loaded every time you reboot or start a new shell\n# ~/.bashrc is called every time you login\necho ". ${PWD}/share/spack/setup-env.sh" >> ~/.bashrc\n'})}),"\n",(0,n.jsxs)(a.p,{children:["NOTE: ",(0,n.jsx)(a.code,{children:"spack"})," creates a folder in your ",(0,n.jsx)(a.code,{children:"HOME"})," directory for storing caches. The folder is located at ",(0,n.jsx)(a.code,{children:"~/.spack"}),"."]}),"\n",(0,n.jsx)(a.pre,{children:(0,n.jsx)(a.code,{className:"language-bash",children:"ls ~/.spack\n"})}),"\n",(0,n.jsxs)(a.h2,{id:"uninstalling-spack",children:["Uninstalling ",(0,n.jsx)(a.code,{children:"spack"})]}),"\n",(0,n.jsx)(a.pre,{children:(0,n.jsx)(a.code,{className:"language-bash",children:'# All packages will be installed under your cloned spack directory\nrm -rf /path/to/spack\n# Spack automatically creates ~/.spack for holding caches\nrm -rf ~/.spack\n# Remove ". ${PWD}/share/spack/setup-env.sh" from ~/.bashrc\n'})}),"\n",(0,n.jsxs)(a.h2,{id:"list-packages-provided-by-spack",children:["List packages provided by ",(0,n.jsx)(a.code,{children:"spack"})]}),"\n",(0,n.jsxs)(a.p,{children:["To identify the set of packages that spack can install, use ",(0,n.jsx)(a.code,{children:"spack list"}),"."]}),"\n",(0,n.jsx)(a.pre,{children:(0,n.jsx)(a.code,{className:"language-bash",children:"# List every package spack has\nspack list\n# Will list all packages which have the word zlib\nspack list zlib\n"})}),"\n",(0,n.jsx)(a.p,{children:"Spack packages also have various properties:"}),"\n",(0,n.jsxs)(a.ol,{children:["\n",(0,n.jsx)(a.li,{children:"Version: the available versions of a package"}),"\n",(0,n.jsx)(a.li,{children:"Variants: add, remove, or modify features of the package. For example, zlib provides a variants for enabling/disabling compiler optimization."}),"\n",(0,n.jsx)(a.li,{children:"Dependencies: the software this package depends on."}),"\n"]}),"\n",(0,n.jsx)(a.pre,{children:(0,n.jsx)(a.code,{className:"language-bash",children:"# Will list the details of a package (versions, description, etc.)\nspack info zlib\n"})}),"\n",(0,n.jsx)(a.p,{children:"In our case, the output is:"}),"\n",(0,n.jsx)(a.pre,{children:(0,n.jsx)(a.code,{className:"language-sh",children:"Package:   zlib\n\nDescription:\n    A free, general-purpose, legally unencumbered lossless data-compression\n    library.\n\nHomepage: https://zlib.net\n\nPreferred version:\n    1.2.12    https://zlib.net/fossils/zlib-1.2.12.tar.gz\n\nSafe versions:\n    1.2.12    https://zlib.net/fossils/zlib-1.2.12.tar.gz\n\nDeprecated versions:\n    1.2.11    https://zlib.net/fossils/zlib-1.2.11.tar.gz\n    1.2.8     https://zlib.net/fossils/zlib-1.2.8.tar.gz\n    1.2.3     https://zlib.net/fossils/zlib-1.2.3.tar.gz\n\nVariants:\n    Name [Default]    When    Allowed values    Description\n    ==============    ====    ==============    ===================================================\n\n    optimize [on]     --      on, off           Enable -O2 for a more optimized lib\n    pic [on]          --      on, off           Produce position-independent code (for shared libs)\n    shared [on]       --      on, off           Enables the build of shared libraries.\n\nBuild Dependencies:\n    None\n\nLink Dependencies:\n    None\n\nRun Dependencies:\n    None\n"})}),"\n",(0,n.jsxs)(a.p,{children:["This output may change with different versions of ",(0,n.jsx)(a.code,{children:"spack"}),"."]}),"\n",(0,n.jsx)(a.h2,{id:"install-packages",children:"Install packages"}),"\n",(0,n.jsx)(a.p,{children:"There are many parameters that can be set when installing a package. However, the installation methods that come up most often are below:"}),"\n",(0,n.jsx)(a.pre,{children:(0,n.jsx)(a.code,{className:"language-bash",children:'# This will install the default tar package\nspack install zlib\n# This will install zlib version 1.2.12\n# This should say zlib 1.2.12 is already installed\nspack install zlib@1.2.12\n# This will install zlib 1.2.11 without optimization\n# The "-" in -optimize means subtract\nspack install zlib@1.2.12 -optimize\n# This will install zlib 1.2.11 with optimization\n# The "+" in +optimize means add\n# This will say that zlib is already installed,\n# since +optimize is enabled by default\nspack install zlib@1.2.12 +optimize\n'})}),"\n",(0,n.jsx)(a.h2,{id:"list-installed-packages",children:"List installed packages"}),"\n",(0,n.jsx)(a.h3,{id:"all-installed-packages",children:"All installed packages"}),"\n",(0,n.jsx)(a.p,{children:"To find all installed packages, run:"}),"\n",(0,n.jsx)(a.pre,{children:(0,n.jsx)(a.code,{className:"language-bash",children:"spack find\n"})}),"\n",(0,n.jsx)(a.h3,{id:"particular-package",children:"Particular package"}),"\n",(0,n.jsx)(a.p,{children:"To find a particluar package, run:"}),"\n",(0,n.jsx)(a.pre,{children:(0,n.jsx)(a.code,{className:"language-bash",children:"spack find zlib\n"})}),"\n",(0,n.jsx)(a.p,{children:"Output:"}),"\n",(0,n.jsx)(a.pre,{children:(0,n.jsx)(a.code,{className:"language-sh",children:"==> 2 installed packages\n-- linux-linuxmint20-zen2 / gcc@9.3.0 ---------------------------\nzlib@1.2.12  zlib@1.2.12\n"})}),"\n",(0,n.jsxs)(a.p,{children:["This output is unhelpful since there are two different versions of ",(0,n.jsx)(a.code,{children:"zlib"})," installed."]}),"\n",(0,n.jsx)(a.h3,{id:"particular-package-with-verbosity",children:"Particular package with verbosity"}),"\n",(0,n.jsx)(a.p,{children:"To get a more verbose output to identify differences between packages, run:"}),"\n",(0,n.jsx)(a.pre,{children:(0,n.jsx)(a.code,{className:"language-bash",children:"spack find -f -v zlib\n"})}),"\n",(0,n.jsx)(a.p,{children:"Output:"}),"\n",(0,n.jsx)(a.pre,{children:(0,n.jsx)(a.code,{className:"language-sh",children:"==> 2 installed packages\n-- linux-linuxmint20-zen2 / gcc@9.3.0 ---------------------------\nzlib@1.2.12%gcc ~optimize+pic+shared patches=0d38234  zlib@1.2.12%gcc +optimize+pic+shared patches=0d38234\n"})}),"\n",(0,n.jsx)(a.h2,{id:"load-packages",children:"Load packages"}),"\n",(0,n.jsxs)(a.p,{children:["In order to make use of a spack package, the package must be loaded. Spack primarily works by setting environment\nvariables, such as ",(0,n.jsx)(a.code,{children:"PATH"})," and ",(0,n.jsx)(a.code,{children:"LD_LIBRARY_PATH"}),"."]}),"\n",(0,n.jsx)(a.p,{children:"To load the environment variables, do:"}),"\n",(0,n.jsx)(a.pre,{children:(0,n.jsx)(a.code,{className:"language-bash",children:"# Load the version of zlib with optimization\nspack load zlib +optimize\n"})}),"\n",(0,n.jsxs)(a.p,{children:["Spack load must be executed every time you open a new shell or reboot your computer. You can add the spack load to your\n",(0,n.jsx)(a.code,{children:"~/.bashrc"})," to avoid having to do this."]}),"\n",(0,n.jsx)(a.p,{children:"There are various caveats to know about spack load:"}),"\n",(0,n.jsxs)(a.ol,{children:["\n",(0,n.jsxs)(a.li,{children:["Spack packages for C++ libraries may use the ",(0,n.jsx)(a.code,{children:"CMAKE_PREFIX_PATH"})," variable and not set any other environment variable.\nThis means you really do need to use CMake when building C++ projects and using spack for installing things. CMake is\ndiscussed later, just be warned that some spack packages do this and building using methods alternative to CMake\n(e.g., building manually) will likely fail."]}),"\n",(0,n.jsxs)(a.li,{children:["Sometimes calling spack load can cause conflict with system packages. Unless otherwise specified, spack will install\neverything -- even things which your system already has installed. This can cause programs to break. I notice that ",(0,n.jsx)(a.code,{children:"vim"}),"\nand ",(0,n.jsx)(a.code,{children:"nano"})," sometimes segfault after spack load because it installs custom versions of software that vim and nano were not\ncompiled with."]}),"\n",(0,n.jsx)(a.li,{children:"You should not run spack load for two different versions of the same package. This will almost definitely lead to correctness\nproblems."}),"\n"]}),"\n",(0,n.jsx)(a.h2,{id:"unload-packages",children:"Unload packages"}),"\n",(0,n.jsx)(a.p,{children:"To unload a package's changes to the current environment, run:"}),"\n",(0,n.jsx)(a.pre,{children:(0,n.jsx)(a.code,{className:"language-bash",children:"# Unloads every spack package\nspack unload\n# Unload the zlib package specifically\nspack unload zlib\n"})}),"\n",(0,n.jsx)(a.h2,{id:"uninstall-packages",children:"Uninstall packages"}),"\n",(0,n.jsx)(a.p,{children:"To uninstall packages, run:"}),"\n",(0,n.jsx)(a.pre,{children:(0,n.jsx)(a.code,{className:"language-bash",children:"# Uninstall a specific package\n# Will fail if more than one package matches query\nspack uninstall zlib +optimize\n# Uninstall all packages matching query\nspack uninstall --all zlib\n"})}),"\n",(0,n.jsxs)(a.h2,{id:"what-happens-if-spack-fails",children:["What happens if ",(0,n.jsx)(a.code,{children:"spack"})," fails?"]}),"\n",(0,n.jsx)(a.p,{children:"Sometimes, you may find that a package fails to compile for some reason. These are the general steps to take when something goes wrong:"}),"\n",(0,n.jsxs)(a.ol,{children:["\n",(0,n.jsx)(a.li,{children:"Check if the software version you're installing is compatible with your machine. If it's not easy to discover with Google or\nAI, then move on to step 2. It's likely a bug in the spack package"}),"\n",(0,n.jsxs)(a.li,{children:["Try checking if there is a new stable release of spack. If so, try upgrading by switching to that version. You should be able to do\nthis without destroying all of your packages by using ",(0,n.jsx)(a.code,{children:"git checkout"})]}),"\n",(0,n.jsxs)(a.li,{children:["Try deleting your spack cache directory. ",(0,n.jsx)(a.code,{children:"rm -rf ~/.spack"})," And then try reinstalling the package."]}),"\n",(0,n.jsx)(a.li,{children:"Try reinstalling spack by following 2.1.2 and 2.1.1 instructions"}),"\n",(0,n.jsx)(a.li,{children:"Submit an issue to the spack team. They aren't a very large team, so it may take time to address. You'll have to either find another\npackage or install from scratch"}),"\n"]}),"\n",(0,n.jsx)(a.p,{children:"Sometimes, spack may successfully install the package, but you may still find that your program doesn't compile or execute. If this is\nthe case, you'll have to do some research (Google, ChatGPT, etc.) to identify why this is happening. You may also find it helpful\nto check exactly what spack installed. You can find where spack installed your package as follows:"}),"\n",(0,n.jsx)(a.pre,{children:(0,n.jsx)(a.code,{className:"language-bash",children:'# Find where the "zlib" package is installed\nspack find --paths zlib\n'})})]})}function h(e={}){const{wrapper:a}={...(0,i.a)(),...e.components};return a?(0,n.jsx)(a,{...e,children:(0,n.jsx)(d,{...e})}):d(e)}},1151:(e,a,s)=>{s.d(a,{Z:()=>c,a:()=>t});var n=s(7294);const i={},l=n.createContext(i);function t(e){const a=n.useContext(l);return n.useMemo((function(){return"function"==typeof e?e(a):{...a,...e}}),[a,e])}function c(e){let a;return a=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:t(e.components),n.createElement(l.Provider,{value:a},e.children)}}}]);