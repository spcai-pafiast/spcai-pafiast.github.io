"use strict";(self.webpackChunkgrc=self.webpackChunkgrc||[]).push([[571],{7411:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>s,default:()=>u,frontMatter:()=>i,metadata:()=>o,toc:()=>c});var a=n(5893),r=n(1151);const i={},s="Data Staging",o={id:"hermes/components/data-staging",title:"Data Staging",description:"Stage-in is the ability to load external datasets into Hermes.",source:"@site/docs/03-hermes/06-components/06-data-staging.md",sourceDirName:"03-hermes/06-components",slug:"/hermes/components/data-staging",permalink:"/docs/hermes/components/data-staging",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:6,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Data Placement",permalink:"/docs/hermes/components/data-placement"},next:{title:"Runtime",permalink:"/docs/hermes/components/runtime"}},l={},c=[{value:"Use Case",id:"use-case",level:2},{value:"Current Status",id:"current-status",level:2},{value:"Utility Script",id:"utility-script",level:2},{value:"Native API",id:"native-api",level:2}];function d(e){const t={code:"code",h1:"h1",h2:"h2",p:"p",pre:"pre",strong:"strong",...(0,r.a)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(t.h1,{id:"data-staging",children:"Data Staging"}),"\n",(0,a.jsxs)(t.p,{children:["Stage-in is the ability to load ",(0,a.jsx)(t.strong,{children:"external"})," datasets into Hermes.\r\nStage-out is the ability export data out of Hermes."]}),"\n",(0,a.jsx)(t.h2,{id:"use-case",children:"Use Case"}),"\n",(0,a.jsx)(t.p,{children:"Data Staging is frequently used for extracting information from large datasets during scientific simulations and workflows.\r\nThis approach shifts the burden of synchronization, aggregation, validation, cleaning, and processing from the PFS and main memory to the high-performance staging area. I/O stalls are reduced by overlapping compute phases with asynchronous I/O, utilizing the high-performance compute network, and leveraging storage tiering."}),"\n",(0,a.jsx)(t.h2,{id:"current-status",children:"Current Status"}),"\n",(0,a.jsx)(t.p,{children:"Currently, stage-in and stage-out can be applied to POSIX files. Stage-in/stage-out can be used to load directories, specific files, or fractions of files into Hermes to be processed by the application.\r\nNote: The ability to stage-in and stage-out HDF5 datasets (as opposed to the entire HDF5 file) is currently under development."}),"\n",(0,a.jsx)(t.h2,{id:"utility-script",children:"Utility Script"}),"\n",(0,a.jsx)(t.p,{children:"The stage-in / stage-out utility scripts provide the following API:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-bash",children:"./stage-in [url] [offset] [size] [dpe]\r\n./stage-out [url]\n"})}),"\n",(0,a.jsx)(t.p,{children:'The [url] parameter for now is just a POSIX path (e.g., "/home/user/hi.txt"). When [size] is 0, the size of the file will be determined automatically. In the future, this parameter could represent an HDF5 dataset using a different schema (e.g., "hdf5::/[dataset-group1]/[dataset-name1]").'}),"\n",(0,a.jsx)(t.p,{children:"An example of a typical stage-in / stage-out workflow is as follows:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-bash",children:'# Create a 4GB file (1GB / proc)\r\nmpirun -n 4 ior -w -k -b 1048576 -o /tmp/hi.txt\r\n# Start the Hermes Daemon\r\nmpirun -n 1 ${HERMES_INSTALL}/hermes_daemon\r\n# Stage-in the entire 4GB file\r\nmpirun -n 4 ${HERMES_INSTALL}/stage_in /tmp/hi.txt 0 0 kRoundRobin\r\n# Read the 4GB file in IOR\r\nmpirun -n 4 \\\r\n-genv HERMES_CONF=${HERMES_CONF} \\\r\n-genv LD_PRELOAD "${HERMES_INSTALL}/libhermes_posix.so" \\\r\n-genv HERMES_STOP_DAEMON 0 \\\r\n-genv ADAPTER_MODE WORKFLOW \\\r\n-genv HERMES_CLIENT 1 \\\r\n-genv HERMES_PAGE_SIZE 1048576 \\\r\nior -r -b 1048576 -o /tmp/hi.txt\r\n# Stage the file back out\r\nmpirun -n 4 ${HERMES_INSTALL/stage_out /tmp/hi.txt\n'})}),"\n",(0,a.jsx)(t.h2,{id:"native-api",children:"Native API"}),"\n",(0,a.jsx)(t.p,{children:"Stage-in / stage-out can also be applied in a native Hermes program."}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-cpp",children:"#include <hermes/staging.h>\r\n\r\nint main(int argc, char **argv) {\r\n  auto stager = DataStagerFactory::Get(url);\r\n  stager->StageIn(url, PlacementEngine::kRoundRobin);\r\n  stager->StageOut(url);\r\n}\n"})})]})}function u(e={}){const{wrapper:t}={...(0,r.a)(),...e.components};return t?(0,a.jsx)(t,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},1151:(e,t,n)=>{n.d(t,{Z:()=>o,a:()=>s});var a=n(7294);const r={},i=a.createContext(r);function s(e){const t=a.useContext(i);return a.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),a.createElement(i.Provider,{value:t},e.children)}}}]);